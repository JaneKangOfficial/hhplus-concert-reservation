<details>
  <summary>ìš”êµ¬ì‚¬í•­</summary>

## Description

- **`ì½˜ì„œíŠ¸ ì˜ˆì•½ ì„œë¹„ìŠ¤`**ë¥¼ êµ¬í˜„í•´ ë´…ë‹ˆë‹¤.
- ëŒ€ê¸°ì—´ ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ê³ , ì˜ˆì•½ ì„œë¹„ìŠ¤ëŠ” ì‘ì—…ê°€ëŠ¥í•œ ìœ ì €ë§Œ ìˆ˜í–‰í•  ìˆ˜ ìˆë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.
- ì‚¬ìš©ìëŠ” ì¢Œì„ì˜ˆì•½ ì‹œì— ë¯¸ë¦¬ ì¶©ì „í•œ ì”ì•¡ì„ ì´ìš©í•©ë‹ˆë‹¤.
- ì¢Œì„ ì˜ˆì•½ ìš”ì²­ì‹œì—, ê²°ì œê°€ ì´ë£¨ì–´ì§€ì§€ ì•Šë”ë¼ë„ ì¼ì • ì‹œê°„ë™ì•ˆ ë‹¤ë¥¸ ìœ ì €ê°€ í•´ë‹¹ ì¢Œì„ì— ì ‘ê·¼í•  ìˆ˜ ì—†ë„ë¡ í•©ë‹ˆë‹¤.

## Requirements

- ì•„ë˜ 5ê°€ì§€ API ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤.
    - ìœ ì € í† í° ë°œê¸‰ API
    - ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ / ì¢Œì„ API
    - ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API
    - ì”ì•¡ ì¶©ì „ / ì¡°íšŒ API
    - ê²°ì œ API
- ê° ê¸°ëŠ¥ ë° ì œì•½ì‚¬í•­ì— ëŒ€í•´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ë¥¼ ë°˜ë“œì‹œ í•˜ë‚˜ ì´ìƒ ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.
- ë‹¤ìˆ˜ì˜ ì¸ìŠ¤í„´ìŠ¤ë¡œ ì–´í”Œë¦¬ì¼€ì´ì…˜ì´ ë™ì‘í•˜ë”ë¼ë„ ê¸°ëŠ¥ì— ë¬¸ì œê°€ ì—†ë„ë¡ ì‘ì„±í•˜ë„ë¡ í•©ë‹ˆë‹¤.
- ë™ì‹œì„± ì´ìŠˆë¥¼ ê³ ë ¤í•˜ì—¬ êµ¬í˜„í•©ë‹ˆë‹¤.
- ëŒ€ê¸°ì—´ ê°œë…ì„ ê³ ë ¤í•´ êµ¬í˜„í•©ë‹ˆë‹¤.

## API Specs

1ï¸âƒ£**`ì£¼ìš”` ìœ ì € ëŒ€ê¸°ì—´ í† í° ê¸°ëŠ¥**

- ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•  í† í°ì„ ë°œê¸‰ë°›ëŠ” APIë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- í† í°ì€ ìœ ì €ì˜ UUID ì™€ í•´ë‹¹ ìœ ì €ì˜ ëŒ€ê¸°ì—´ì„ ê´€ë¦¬í•  ìˆ˜ ìˆëŠ” ì •ë³´ ( ëŒ€ê¸° ìˆœì„œ or ì”ì—¬ ì‹œê°„ ë“± ) ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
- ì´í›„ ëª¨ë“  API ëŠ” ìœ„ í† í°ì„ ì´ìš©í•´ ëŒ€ê¸°ì—´ ê²€ì¦ì„ í†µê³¼í•´ì•¼ ì´ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

> ê¸°ë³¸ì ìœ¼ë¡œ í´ë§ìœ¼ë¡œ ë³¸ì¸ì˜ ëŒ€ê¸°ì—´ì„ í™•ì¸í•œë‹¤ê³  ê°€ì •í•˜ë©°, ë‹¤ë¥¸ ë°©ì•ˆ ë˜í•œ ê³ ë ¤í•´ë³´ê³  êµ¬í˜„í•´ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
>

**2ï¸âƒ£`ê¸°ë³¸` ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ / ì¢Œì„ API**

- ì˜ˆì•½ê°€ëŠ¥í•œ ë‚ ì§œì™€ í•´ë‹¹ ë‚ ì§œì˜ ì¢Œì„ì„ ì¡°íšŒí•˜ëŠ” API ë¥¼ ê°ê° ì‘ì„±í•©ë‹ˆë‹¤.
- ì˜ˆì•½ ê°€ëŠ¥í•œ ë‚ ì§œ ëª©ë¡ì„ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë‚ ì§œ ì •ë³´ë¥¼ ì…ë ¥ë°›ì•„ ì˜ˆì•½ê°€ëŠ¥í•œ ì¢Œì„ì •ë³´ë¥¼ ì¡°íšŒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

> ì¢Œì„ ì •ë³´ëŠ” 1 ~ 50 ê¹Œì§€ì˜ ì¢Œì„ë²ˆí˜¸ë¡œ ê´€ë¦¬ë©ë‹ˆë‹¤.
>

3ï¸âƒ£**`ì£¼ìš”` ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API**

- ë‚ ì§œì™€ ì¢Œì„ ì •ë³´ë¥¼ ì…ë ¥ë°›ì•„ ì¢Œì„ì„ ì˜ˆì•½ ì²˜ë¦¬í•˜ëŠ” API ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- ì¢Œì„ ì˜ˆì•½ê³¼ ë™ì‹œì— í•´ë‹¹ ì¢Œì„ì€ ê·¸ ìœ ì €ì—ê²Œ ì•½ 5ë¶„ê°„ ì„ì‹œ ë°°ì •ë©ë‹ˆë‹¤. ( ì‹œê°„ì€ ì •ì±…ì— ë”°ë¼ ììœ¨ì ìœ¼ë¡œ ì •ì˜í•©ë‹ˆë‹¤. )
- ë§Œì•½ ë°°ì • ì‹œê°„ ë‚´ì— ê²°ì œê°€ ì™„ë£Œë˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ì¢Œì„ì— ëŒ€í•œ ì„ì‹œ ë°°ì •ì€ í•´ì œë˜ì–´ì•¼ í•˜ë©° ë‹¤ë¥¸ ì‚¬ìš©ìëŠ” ì˜ˆì•½í•  ìˆ˜ ì—†ì–´ì•¼ í•œë‹¤.

4ï¸âƒ£**`ê¸°ë³¸`**  **ì”ì•¡ ì¶©ì „ / ì¡°íšŒ API**

- ê²°ì œì— ì‚¬ìš©ë  ê¸ˆì•¡ì„ API ë¥¼ í†µí•´ ì¶©ì „í•˜ëŠ” API ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- ì‚¬ìš©ì ì‹ë³„ì ë° ì¶©ì „í•  ê¸ˆì•¡ì„ ë°›ì•„ ì”ì•¡ì„ ì¶©ì „í•©ë‹ˆë‹¤.
- ì‚¬ìš©ì ì‹ë³„ìë¥¼ í†µí•´ í•´ë‹¹ ì‚¬ìš©ìì˜ ì”ì•¡ì„ ì¡°íšŒí•©ë‹ˆë‹¤.

5ï¸âƒ£**`ì£¼ìš”` ê²°ì œ API**

- ê²°ì œ ì²˜ë¦¬í•˜ê³  ê²°ì œ ë‚´ì—­ì„ ìƒì„±í•˜ëŠ” API ë¥¼ ì‘ì„±í•©ë‹ˆë‹¤.
- ê²°ì œê°€ ì™„ë£Œë˜ë©´ í•´ë‹¹ ì¢Œì„ì˜ ì†Œìœ ê¶Œì„ ìœ ì €ì—ê²Œ ë°°ì •í•˜ê³  ëŒ€ê¸°ì—´ í† í°ì„ ë§Œë£Œì‹œí‚µë‹ˆë‹¤.

<aside>
ğŸ’¡ **KEY POINT**

</aside>

- ìœ ì €ê°„ ëŒ€ê¸°ì—´ì„ ìš”ì²­ ìˆœì„œëŒ€ë¡œ ì •í™•í•˜ê²Œ ì œê³µí•  ë°©ë²•ì„ ê³ ë¯¼í•´ ë´…ë‹ˆë‹¤.
- ë™ì‹œì— ì—¬ëŸ¬ ì‚¬ìš©ìê°€ ì˜ˆì•½ ìš”ì²­ì„ í–ˆì„ ë•Œ, ì¢Œì„ì´ ì¤‘ë³µìœ¼ë¡œ ë°°ì • ê°€ëŠ¥í•˜ì§€ ì•Šë„ë¡ í•©ë‹ˆë‹¤.

</details>



<details>
  <summary>Milestone</summary>

[Milestone](https://github.com/users/JaneKangOfficial/projects/3)
</details>



<details> 
  <summary>ì‹œí€€ìŠ¤ ë‹¤ì´ì–´ê·¸ë¨</summary>

### 1. í† í° ë°œê¸‰ API

![1 á„á…©á„á…³á†« á„‡á…¡á†¯á„€á…³á†¸](https://github.com/JaneKangOfficial/hhplus-concert-reservation/assets/50077963/678f952c-f307-413a-8b06-7a8dfdc4c1fd)

### 2. ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ / ì¢Œì„ API

![2 á„‹á…¨á„‹á…£á†¨á„€á…¡á„‚á…³á†¼á„‚á…¡á†¯á„á…¡:á„Œá…ªá„‰á…¥á†¨](https://github.com/JaneKangOfficial/hhplus-concert-reservation/assets/50077963/677ffee7-894b-4200-8b06-629b347bc68f)

### 3. ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API

![3 á„Œá…ªá„‰á…¥á†¨á„‹á…¨á„‹á…£á†¨á„‹á…­á„á…¥á†¼](https://github.com/JaneKangOfficial/hhplus-concert-reservation/assets/50077963/73b7598d-1efc-45b5-b032-2cf26da6eea7)

### 4. ì”ì•¡ ì¶©ì „ / ì¡°íšŒ API

![4 á„Œá…¡á†«á„‹á…¢á†¨á„á…®á†¼á„Œá…¥á†«:á„Œá…©á„’á…¬](https://github.com/JaneKangOfficial/hhplus-concert-reservation/assets/50077963/8449b9ad-4173-442f-a6f2-741e3495e5cf)

### 5. ê²°ì œ API

![5 á„€á…§á†¯á„Œá…¦](https://github.com/JaneKangOfficial/hhplus-concert-reservation/assets/50077963/07baa628-0af0-4a72-886a-d978bfcb1ec9)

</details>



<details>
  <summary>ERD ë‹¤ì´ì–´ê·¸ë¨</summary>

[ERD](https://dbdiagram.io/d/concert3-668552fb9939893daef24953)
<img width="981" alt="" src="https://github.com/JaneKangOfficial/hhplus-concert-reservation/assets/50077963/962f1400-b055-4618-8375-1ce71f2d5df0">

</details>



<details>
  <summary>API ëª…ì„¸</summary>

### 1. ìœ ì € ëŒ€ê¸°ì—´ í† í° ###

|         |                             |
|---------|-----------------------------|
| GET     | /api/concert/token/{userId} |
| Request | Long userId                 |               

```
Response
{
    "userId": 1,
    "token": "token"
}
```

### 2. ì˜ˆì•½ ê°€ëŠ¥ ë‚ ì§œ API ###

|               |                   |
|---------------|-------------------|
| GET           | /api/concert/date |
| Request       | Long concertId    |
| Authorization | "token"           |

```
Response
{
    "dateId": [
        1,
        2
    ],
    "concertId": 1,
    "availableDates": [
        "2024-06-20",
        "2024-06-21"
    ]
}
```

### 3. ì˜ˆì•½ ê°€ëŠ¥ ì¢Œì„ API ###

|               |                             |
|---------------|-----------------------------|
| GET           | /api/concert/seat           |
| Request       | Long concertId, Long dateId |
| Authorization | "token"                     |

```
Response
{
    "concertId": 1,
    "dateId": 1,
    "seatId": [
        1,
        2,
        3
    ]
}
```

### 4. ì¢Œì„ ì˜ˆì•½ ìš”ì²­ API ###

|               |                          |
|---------------|--------------------------|
| POST          | /api/concert/reservation |
| Authorization | "token"                  |

```
Request
{
    "userId":1,
    "concertId": 1,
    "dateId": 1,
    "seatId": 1
}

```

```
Response
{
    "reservationId": 1,
    "userId": 2,
    "concertId": 1,
    "dateId": 3,
    "seatId": 5,
    "status": "APPLY"
}
```

### 5. ì”ì•¡ ì¶©ì „ API ###

|               |                    |
|---------------|--------------------|
| POST          | /api/concert/point |
| Authorization | "token"            |

```
Request
{
    "userId":1,
    "point": 100,
    "status": "CHARGE"
}
```

```
Response
{
    "total": 1000
}
```

### 6. ì”ì•¡ ì¡°íšŒ API ###

|         |                      |
|---------|----------------------|
| GET     | /api/concert/balance |
| Request | Long userId          |

```
Response
{
    "total": 1000
}
```

### 5. ê²°ì œ API ###

|               |                      |
|---------------|----------------------|
| POST          | /api/concert/payment |
| Authorization | "token"              |

```
Request
{
    "userId":1,
    "concertId": 1,
    "dateId": 1,
    "seatId": 1
}
```

```
Response
{
    "paymentId": 1,
    "userId": 1,
    "concertId": 1,
    "dateId": 1,
    "seatId": 1,
    "total": 10000,
    "status": "COMPLETE"
}
```

</details>

<details>
  <summary>ë™ì‹œì„± ë¬¸ì œ</summary>

### 1. ì½˜ì„œíŠ¸ ì„œë¹„ìŠ¤ì—ì„œ ë™ì‹œì„± ì´ìŠˆ ë°œìƒí•  ìˆ˜ ìˆëŠ” ë¡œì§

- í¬ì¸íŠ¸ ì¶©ì „/ì‚¬ìš©
- ì¢Œì„ ì˜ˆì•½

### 2. Transactionì˜ ë²”ìœ„, ë‚™ê´€ì  ë½, ë¹„ê´€ì  ë½ í…ŒìŠ¤íŠ¸ ê²€ì¦

1) ë‚™ê´€ì  ë½

- @Version - ì½ê¸° ê°€ëŠ¥, ìˆ˜ì • ë¶ˆê°€ëŠ¥
- Transactionì˜ ë²”ìœ„ : Select, Update
- ë™ì‹œì— ì§„ì…í•´ì„œ Version 0ì„ ì½ì€ ì—¬ëŸ¬ Threadë“¤ ì¤‘ì—ì„œ ì²˜ìŒ Updateí•œ Threadë§Œ ì„±ê³µ
- Update ì„±ê³µ í›„ì— Version 1ë¡œ ë³€ê²½ë¨
- ì´í›„ ë‚˜ë¨¸ì§€ Version 0ì€ Rollbackìœ¼ë¡œ ì‹¤íŒ¨
- Version 1ì„ ì½ì€ ì—¬ëŸ¬ Threadë“¤ ì¤‘ì—ì„œ ì²˜ìŒ Updateí•œ Threadë§Œ ì„±ê³µ
- Update ì„±ê³µ í›„ì— Version 2ë¡œ ë³€ê²½ë¨

```
Thread 1 { Select Vesrion0    Update     END }
Thread 2 { Select Vesrion0                     Update Rollback }
Thread 3 {                                     Select Vesrion1       Update       END }
Thread 4 {                                     Select Vesrion1                          Update Rollback }
```

2) ë¹„ê´€ì  ë½

- @Lock(LockModeType.PESSIMISTIC_WRITE) - ì½ê¸°, ì“°ê¸° ëª¨ë‘ ë¶ˆê°€ëŠ¥

- Transactionì˜ ë²”ìœ„ -> Select, Update
- Thread 1 {Select -> Update -> Thread ì¢…ë£Œ} -> Thread 2 {Select -> Update -> ìŠ¤ë ˆë“œ ì¢…ë£Œ} ê°€ ìˆœì„œëŒ€ë¡œ ì¼ì–´ë‚¨
- ì‹¤íŒ¨ ì—†ì´ ëª¨ë“  Thread Update
- Thread ì¢…ë£Œê¹Œì§€ ëŒ€ê¸°í•´ì•¼ í•´ì„œ ë²”ìœ„ê°€ í¬ë©´ Timeoutê³¼ DB Connection Pool ì ë ¹ ë“± ì „ì²´ì ì¸ ì„±ëŠ¥ ì €í•˜ ë¬¸ì œê°€ ë°œìƒ

```
Thread 1 { Select    Update     END }
Thread 2 {                           Select    Update     END }
Thread 3 {                                                     Select    Update     END }
```

### 3. ê²°ë¡ 

1. í¬ì¸íŠ¸ ì¶©ì „/ì‚¬ìš©

- ë‚™ê´€ì  ë½ í‰ê·  ì†Œìš” ì‹œê°„ (100íšŒ) : 280ms
- ë¹„ê´€ì  ë½ í‰ê·  ì†Œìš” ì‹œê°„ (100íšŒ) : 558ms

> í¬ì¸íŠ¸ ì¶©ì „/ì‚¬ìš©ì€ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì‹¤íŒ¨ ì—†ì´ ìˆœì„œëŒ€ë¡œ ì²˜ë¦¬í•´ì•¼ í•˜ëŠ” ë¡œì§ì´ê¸° ë•Œë¬¸ì— `ë¹„ê´€ì  ë½`ì´ ì í•©í•˜ë‹¤ê³  íŒë‹¨

2. ì¢Œì„ ì˜ˆì•½

- ë‚™ê´€ì  ë½ í‰ê·  ì†Œìš” ì‹œê°„ (100ì¸) : 119ms
- ë¹„ê´€ì  ë½ í‰ê·  ì†Œìš” ì‹œê°„ (100ì¸) : 272ms

> ì¢Œì„ ì˜ˆì•½ì€ 1ëª…ë§Œ ì„±ê³µí•˜ê³  ë‚˜ë¨¸ì§€ëŠ” ì‹¤íŒ¨í•´ì•¼ í•˜ëŠ” ë¡œì§ì´ê¸° ë•Œë¬¸ì— `ë‚™ê´€ì  ë½`ì´ ì í•©í•˜ë‹¤ê³  íŒë‹¨


</details>
